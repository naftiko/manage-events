openapi: 3.1.0
info:
  title: HubSpot OAuth 2.0 API
  version: v1
  description: |
    HubSpot's OAuth 2.0 implementation provides secure authorization for applications 
    to access HubSpot resources on behalf of users.
    
    HubSpot supports the OAuth 2.0 Authorization Code grant type, which consists of:
    1. Directing users to HubSpot's authorization server
    2. Users reviewing and granting permissions
    3. Receiving an authorization code via redirect
    4. Exchanging the code for access and refresh tokens
    5. Using access tokens to make API calls
    6. Refreshing expired access tokens
    
    ## Key Features
    - Access tokens expire after 30 minutes (1800 seconds)
    - Refresh tokens can be used to obtain new access tokens
    - Scopes define the level of access granted to your application
    - State parameter helps prevent CSRF attacks
    
    ## Important Notes
    - The user installing the app must be a Super Admin
    - Access tokens reflect app scopes, not individual user permissions
    - HTTPS is required for production redirect URIs
  contact:
    name: HubSpot Developer Support
    url: https://developers.hubspot.com
  termsOfService: https://legal.hubspot.com/api-terms-of-service
  license:
    name: HubSpot API Terms
    url: https://legal.hubspot.com/api-terms-of-service

servers:
  - url: https://app.hubspot.com
    description: HubSpot Authorization Server
  - url: https://api.hubapi.com
    description: HubSpot API Server

paths:
  /oauth/authorize:
    get:
      operationId: authorizeApp
      summary: Authorization endpoint
      description: |
        Initiates the OAuth 2.0 authorization flow by directing the user to HubSpot's 
        authorization page. The user will review the requested permissions and either 
        grant or deny access to your application.
        
        This endpoint should be called by redirecting the user's browser to the 
        constructed URL with the required parameters.
        
        ## Flow
        1. Build authorization URL with required parameters
        2. Redirect user's browser to this endpoint
        3. User logs in (if needed) and reviews permissions
        4. User grants or denies access
        5. User is redirected to your redirect_uri with code or error
        
        ## Important
        - Users must have access to all requested scopes or installation will fail
        - Super Admin access is required to install apps
        - Use the state parameter to prevent CSRF attacks
      tags:
        - OAuth Authorization
      servers:
        - url: https://app.hubspot.com
      parameters:
        - name: client_id
          in: query
          required: true
          description: |
            The client ID that identifies your app. You can find this on your 
            app's settings page in the HubSpot developer portal.
          schema:
            type: string
            format: uuid
          example: "7fff1e36-2d40-4ae1-bbb1-5266d59564fb"
        
        - name: scope
          in: query
          required: true
          description: |
            The scopes your application is requesting, separated by URL-encoded 
            spaces (%20). These define what resources your app can access.
            
            Common scopes include:
            - oauth: Basic OAuth access
            - crm.objects.contacts.read: Read contacts
            - crm.objects.contacts.write: Write contacts
            - crm.objects.companies.read: Read companies
            - content: Access to content tools
            - automation: Access to automation features
          schema:
            type: string
          example: "oauth%20crm.objects.contacts.read"
        
        - name: redirect_uri
          in: query
          required: true
          description: |
            The URL that the user will be redirected to after they authorize your 
            app. This must match one of the redirect URIs configured in your app 
            settings. HTTPS is required for production applications.
          schema:
            type: string
            format: uri
          example: "https://www.example.com/auth-callback"
        
        - name: optional_scope
          in: query
          required: false
          description: |
            Optional scopes that will be dropped if the selected HubSpot account 
            does not have access to those products. Use this for scopes that would 
            be nice to have but aren't required for your app to function.
          schema:
            type: string
          example: "automation"
        
        - name: state
          in: query
          required: false
          description: |
            A unique string value that can be used to maintain the user's state 
            when they're redirected back to your app. This helps prevent CSRF 
            attacks. You should generate a random nonce and validate it matches 
            when you receive the callback.
          schema:
            type: string
          example: "WeHH_yy2irpl8UYAvv-my"
      
      responses:
        '302':
          description: |
            Redirect to authorization page or back to redirect_uri.
            
            After user grants access, redirects to redirect_uri with:
            - code: Authorization code (on success)
            - state: The state value you provided (if any)
            
            If user denies access, no redirect occurs.
          headers:
            Location:
              description: Redirect URL
              schema:
                type: string
              examples:
                successRedirect:
                  $ref: '#/components/examples/AuthorizeSuccessRedirect'
        
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
              examples:
                invalidClientId:
                  $ref: '#/components/examples/AuthorizeInvalidClientId'
                invalidRedirectUri:
                  $ref: '#/components/examples/AuthorizeInvalidRedirectUri'
                invalidScope:
                  $ref: '#/components/examples/AuthorizeInvalidScope'
        
        '403':
          description: |
            Forbidden - User doesn't have required permissions.
            The user must be a Super Admin or have access to all requested scopes.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
              examples:
                insufficientPermissions:
                  $ref: '#/components/examples/AuthorizeInsufficientPermissions'
                notSuperAdmin:
                  $ref: '#/components/examples/AuthorizeNotSuperAdmin'

  /oauth/v1/token:
    post:
      operationId: exchangeToken
      summary: Token endpoint
      description: |
        Exchange an authorization code for access and refresh tokens, or refresh 
        an expired access token using a refresh token.
        
        This endpoint supports two grant types:
        1. authorization_code: Exchange authorization code for tokens
        2. refresh_token: Exchange refresh token for new access token
        
        ## Access Token Lifecycle
        - Access tokens expire after 30 minutes (1800 seconds)
        - Use the refresh token to obtain a new access token
        - Each token exchange returns a new refresh token
        - Store tokens securely
      tags:
        - OAuth Token
      servers:
        - url: https://api.hubapi.com
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              oneOf:
                - $ref: '#/components/schemas/AuthorizationCodeRequest'
                - $ref: '#/components/schemas/RefreshTokenRequest'
              discriminator:
                propertyName: grant_type
                mapping:
                  authorization_code: '#/components/schemas/AuthorizationCodeRequest'
                  refresh_token: '#/components/schemas/RefreshTokenRequest'
            examples:
              authorizationCode:
                $ref: '#/components/examples/TokenRequestAuthorizationCode'
              refreshToken:
                $ref: '#/components/examples/TokenRequestRefreshToken'
      
      responses:
        '200':
          description: |
            Successful token exchange. Returns access token, refresh token, 
            and expiration time.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
              examples:
                authCodeExchange:
                  $ref: '#/components/examples/TokenResponseAuthCodeExchange'
                refreshTokenExchange:
                  $ref: '#/components/examples/TokenResponseRefreshTokenExchange'
        
        '400':
          description: |
            Bad request - Invalid request parameters.
            Common causes:
            - Invalid or expired authorization code
            - Invalid or expired refresh token
            - Mismatched redirect_uri
            - Invalid grant_type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
              examples:
                invalidCode:
                  $ref: '#/components/examples/TokenErrorInvalidCode'
                expiredCode:
                  $ref: '#/components/examples/TokenErrorExpiredCode'
                invalidRefreshToken:
                  $ref: '#/components/examples/TokenErrorInvalidRefreshToken'
                expiredRefreshToken:
                  $ref: '#/components/examples/TokenErrorExpiredRefreshToken'
                redirectUriMismatch:
                  $ref: '#/components/examples/TokenErrorRedirectUriMismatch'
                unsupportedGrantType:
                  $ref: '#/components/examples/TokenErrorUnsupportedGrantType'
        
        '401':
          description: |
            Unauthorized - Invalid client credentials.
            Check that your client_id and client_secret are correct.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
              examples:
                invalidClientId:
                  $ref: '#/components/examples/TokenErrorInvalidClientId'
                invalidClientSecret:
                  $ref: '#/components/examples/TokenErrorInvalidClientSecret'

components:
  schemas:
    AuthorizationCodeRequest:
      type: object
      required:
        - grant_type
        - client_id
        - client_secret
        - redirect_uri
        - code
      properties:
        grant_type:
          type: string
          enum:
            - authorization_code
          description: Must be "authorization_code"
          example: "authorization_code"
        
        client_id:
          type: string
          format: uuid
          description: Your app's client ID from the app settings
          example: "7fff1e36-2d40-4ae1-bbb1-5266d59564fb"
        
        client_secret:
          type: string
          format: uuid
          description: Your app's client secret (keep this secure!)
          example: "7c3ce02c-0f0c-4c9f-9700-92440c9bdf2d"
        
        redirect_uri:
          type: string
          format: uri
          description: The redirect URI used when the user authorized your app
          example: "https://www.example.com/auth-callback"
        
        code:
          type: string
          format: uuid
          description: The authorization code received from the OAuth server
          example: "5771f587-2fe7-40e8-8784-042fb4bc2c31"

    RefreshTokenRequest:
      type: object
      required:
        - grant_type
        - client_id
        - client_secret
        - redirect_uri
        - refresh_token
      properties:
        grant_type:
          type: string
          enum:
            - refresh_token
          description: Must be "refresh_token"
          example: "refresh_token"
        
        client_id:
          type: string
          format: uuid
          description: Your app's client ID from the app settings
          example: "7fff1e36-2d40-4ae1-bbb1-5266d59564fb"
        
        client_secret:
          type: string
          format: uuid
          description: Your app's client secret (keep this secure!)
          example: "7c3ce02c-0f0c-4c9f-9700-92440c9bdf2d"
        
        redirect_uri:
          type: string
          format: uri
          description: The redirect URI used when the user authorized your app
          example: "https://www.example.com/auth-callback"
        
        refresh_token:
          type: string
          format: uuid
          description: The refresh token received when the user authorized your app
          example: "b9443019-30fe-4df1-a67e-3d75cbd0f726"

    TokenResponse:
      type: object
      required:
        - access_token
        - refresh_token
        - expires_in
      properties:
        access_token:
          type: string
          description: |
            The access token to use for API requests. Include this in the 
            Authorization header as a Bearer token. Expires after the time 
            specified in expires_in (currently 30 minutes).
          example: "CN2zlYnmLBICAQIYgZXFLyCWp1Yoy_9GMhkAgddk-zDc-H_rOad1X2s6Qv3fmG1spSY0Og0ACgJBAAADAIADAAABQhkAgddk-03q2qdkwdXbYWCoB9g3LA97OJ9I"
        
        refresh_token:
          type: string
          format: uuid
          description: |
            The refresh token to use for obtaining new access tokens. Store this 
            securely as it can be used to generate new access tokens without user 
            interaction.
          example: "6f18f21e-a743-4509-b7fd-1a5e632fffa1"
        
        expires_in:
          type: integer
          description: |
            The number of seconds until the access token expires. Currently set 
            to 1800 seconds (30 minutes). Your app should refresh the token 
            before this time elapses.
          example: 1800
          minimum: 1

    OAuthError:
      type: object
      required:
        - status
        - message
      properties:
        status:
          type: string
          description: Error status
          example: "error"
        
        message:
          type: string
          description: Human-readable error message
          example: "invalid authorization code"
        
        category:
          type: string
          description: Error category for programmatic handling
          enum:
            - INVALID_GRANT
            - INVALID_CLIENT
            - INVALID_REQUEST
            - UNAUTHORIZED_CLIENT
            - UNSUPPORTED_GRANT_TYPE
            - INVALID_SCOPE
            - ACCESS_DENIED
          example: "INVALID_GRANT"
        
        correlationId:
          type: string
          format: uuid
          description: Unique identifier for tracking the error
          example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: token
      description: |
        Use the access token obtained from the OAuth flow in the Authorization 
        header as a Bearer token.
        
        Example: Authorization: Bearer YOUR_ACCESS_TOKEN
        
        ## Important Notes
        - Access tokens expire after 30 minutes
        - Tokens reflect app scopes, not individual user permissions
        - Store tokens securely and never expose them in client-side code

  examples:
    # ============================================
    # Authorization Endpoint Examples
    # ============================================
    
    # Authorization URL Examples
    AuthorizationUrlComplete:
      summary: Complete authorization URL
      description: Example of a fully constructed authorization URL with all parameters
      value: "https://app.hubspot.com/oauth/authorize?client_id=7fff1e36-2d40-4ae1-bbb1-5266d59564fb&scope=oauth%20crm.objects.contacts.read&redirect_uri=https://www.example.com/auth-callback&state=WeHH_yy2irpl8UYAvv-my"
    
    # 302 Response Examples
    AuthorizeSuccessRedirect:
      summary: Successful authorization redirect
      description: User granted access and is redirected back with authorization code
      value: "https://www.example.com/auth-callback?code=5771f587-2fe7-40e8-8784-042fb4bc2c31&state=WeHH_yy2irpl8UYAvv-my"
    
    # 400 Response Examples
    AuthorizeInvalidClientId:
      summary: Invalid client ID
      description: The provided client_id does not match any registered application
      value:
        status: "error"
        message: "client_id is invalid"
        category: "INVALID_REQUEST"
        correlationId: "f8a1b2c3-d4e5-6789-abcd-ef0123456789"
    
    AuthorizeInvalidRedirectUri:
      summary: Invalid redirect URI
      description: The redirect_uri does not match any URI registered for the application
      value:
        status: "error"
        message: "redirect_uri 'https://malicious.com/callback' does not match any configured redirect URIs"
        category: "INVALID_REQUEST"
        correlationId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
    
    AuthorizeInvalidScope:
      summary: Invalid scope requested
      description: One or more requested scopes are invalid or not recognized
      value:
        status: "error"
        message: "scope 'invalid.scope.name' is not a valid scope"
        category: "INVALID_SCOPE"
        correlationId: "b2c3d4e5-f6a7-8901-bcde-f23456789012"
    
    # 403 Response Examples
    AuthorizeInsufficientPermissions:
      summary: Insufficient permissions
      description: User does not have access to all requested scopes
      value:
        status: "error"
        message: "user does not have access to requested scope 'automation'"
        category: "ACCESS_DENIED"
        correlationId: "c3d4e5f6-a7b8-9012-cdef-345678901234"
    
    AuthorizeNotSuperAdmin:
      summary: User is not a Super Admin
      description: App installation requires Super Admin access
      value:
        status: "error"
        message: "app installation requires Super Admin access"
        category: "ACCESS_DENIED"
        correlationId: "d4e5f6a7-b8c9-0123-def0-456789012345"
    
    # ============================================
    # Token Endpoint Examples
    # ============================================
    
    # Request Examples
    TokenRequestAuthorizationCode:
      summary: Exchange authorization code for tokens
      description: Request body for exchanging an authorization code for access and refresh tokens
      value:
        grant_type: "authorization_code"
        client_id: "7fff1e36-2d40-4ae1-bbb1-5266d59564fb"
        client_secret: "7c3ce02c-0f0c-4c9f-9700-92440c9bdf2d"
        redirect_uri: "https://www.example.com/auth-callback"
        code: "5771f587-2fe7-40e8-8784-042fb4bc2c31"
    
    TokenRequestRefreshToken:
      summary: Refresh an expired access token
      description: Request body for using a refresh token to obtain a new access token
      value:
        grant_type: "refresh_token"
        client_id: "7fff1e36-2d40-4ae1-bbb1-5266d59564fb"
        client_secret: "7c3ce02c-0f0c-4c9f-9700-92440c9bdf2d"
        redirect_uri: "https://www.example.com/auth-callback"
        refresh_token: "b9443019-30fe-4df1-a67e-3d75cbd0f726"
    
    # 200 Response Examples
    TokenResponseAuthCodeExchange:
      summary: Successful authorization code exchange
      description: Response after successfully exchanging an authorization code for tokens
      value:
        access_token: "CN2zlYnmLBICAQIYgZXFLyCWp1Yoy_9GMhkAgddk-zDc-H_rOad1X2s6Qv3fmG1spSY0Og0ACgJBAAADAIADAAABQhkAgddk-03q2qdkwdXbYWCoB9g3LA97OJ9I"
        refresh_token: "6f18f21e-a743-4509-b7fd-1a5e632fffa1"
        expires_in: 1800
    
    TokenResponseRefreshTokenExchange:
      summary: Successful refresh token exchange
      description: Response after successfully using a refresh token to obtain new tokens
      value:
        access_token: "CK3amZroLBICAQIYgZXFLyDRq2Xpz_8GMhkBgddk-zDc-I_sObe2Y3t7Rw4gNh2tqTZ1Ph1BCgJBAAADAIADAAABQhkBgddk-14r3qelxeYcYDpC0h4iMB98PK0J"
        refresh_token: "8e55g32f-b854-5620-c8ge-2b6f743ggfb2"
        expires_in: 1800
    
    # 400 Response Examples
    TokenErrorInvalidCode:
      summary: Invalid authorization code
      description: The provided authorization code is not valid
      value:
        status: "error"
        message: "invalid authorization code"
        category: "INVALID_GRANT"
        correlationId: "e5f6a7b8-c9d0-1234-ef01-567890123456"
    
    TokenErrorExpiredCode:
      summary: Expired authorization code
      description: The authorization code has expired (codes are valid for a short time)
      value:
        status: "error"
        message: "authorization code has expired"
        category: "INVALID_GRANT"
        correlationId: "f6a7b8c9-d0e1-2345-f012-678901234567"
    
    TokenErrorInvalidRefreshToken:
      summary: Invalid refresh token
      description: The provided refresh token is not valid
      value:
        status: "error"
        message: "invalid refresh token"
        category: "INVALID_GRANT"
        correlationId: "a7b8c9d0-e1f2-3456-0123-789012345678"
    
    TokenErrorExpiredRefreshToken:
      summary: Expired refresh token
      description: The refresh token has expired or been revoked
      value:
        status: "error"
        message: "refresh token has been revoked or expired"
        category: "INVALID_GRANT"
        correlationId: "b8c9d0e1-f2a3-4567-1234-890123456789"
    
    TokenErrorRedirectUriMismatch:
      summary: Redirect URI mismatch
      description: The redirect_uri does not match the one used during authorization
      value:
        status: "error"
        message: "redirect_uri must match the URI used in the authorization request"
        category: "INVALID_REQUEST"
        correlationId: "c9d0e1f2-a3b4-5678-2345-901234567890"
    
    TokenErrorUnsupportedGrantType:
      summary: Unsupported grant type
      description: The grant_type is not supported
      value:
        status: "error"
        message: "unsupported grant_type 'client_credentials'"
        category: "UNSUPPORTED_GRANT_TYPE"
        correlationId: "d0e1f2a3-b4c5-6789-3456-012345678901"
    
    # 401 Response Examples
    TokenErrorInvalidClientId:
      summary: Invalid client ID
      description: The client_id does not match any registered application
      value:
        status: "error"
        message: "invalid client credentials"
        category: "INVALID_CLIENT"
        correlationId: "e1f2a3b4-c5d6-7890-4567-123456789012"
    
    TokenErrorInvalidClientSecret:
      summary: Invalid client secret
      description: The client_secret does not match the registered application
      value:
        status: "error"
        message: "invalid client credentials"
        category: "INVALID_CLIENT"
        correlationId: "f2a3b4c5-d6e7-8901-5678-234567890123"

tags:
  - name: OAuth Authorization
    description: |
      Authorization endpoints for initiating the OAuth 2.0 flow and obtaining 
      user consent for your application.
  
  - name: OAuth Token
    description: |
      Token management endpoints for exchanging authorization codes and 
      refreshing access tokens.

x-hubspot-documentation:
  quickstart: https://developers.hubspot.com/docs/api/oauth-quickstart
  reference: https://developers.hubspot.com/docs/api/oauth/overview
  scopes: https://developers.hubspot.com/docs/api/oauth-scopes

x-hubspot-best-practices:
  - Store client_secret securely and never expose it in client-side code
  - Always validate the state parameter to prevent CSRF attacks
  - Implement token refresh before access tokens expire
  - Handle authorization errors gracefully
  - Request only the scopes your app actually needs
  - Use HTTPS for all redirect URIs in production
  - Store refresh tokens securely
  - Implement proper error handling for expired or invalid tokens
